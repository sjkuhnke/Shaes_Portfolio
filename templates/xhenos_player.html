{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{{ player_name }} - Player Database</title>
  <meta name="description" content="View all trainers battled by {{ player_name }} in Pokémon Xhenos.">

  <link rel="shortcut icon" href="{% static 'images/logo.ico' %}" type="image/x-icon">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<main>
  <article>
    <a href="/xhenos/trainers/" class="back-button">
      <i class="fas fa-arrow-left"></i> Back to Database
    </a>

    <!-- Player Hero -->
    <div class="player-hero">
      <div class="player-header">
        <div class="player-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="player-details">
          <h1>{{ player_name }}</h1>
          <div class="player-meta">
            <span class="meta-item">
              <i class="fas fa-gamepad"></i>
              Player
            </span>
            <span class="meta-item">
              <i class="fas fa-users"></i>
              {{ trainers|length }} Trainer{{ trainers|length|pluralize }} Battled
            </span>
            {% if last_battle %}
            <span class="meta-item">
              <i class="fas fa-clock"></i>
              Last Battle: {{ last_battle|date:"M d, Y" }}
            </span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% if trainers %}
    <!-- Stats Overview -->
    <section class="stats-overview">
      <div class="stats-grid-compact">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-users"></i></div>
          <div class="stat-label">Total Trainers</div>
          <div class="stat-value">{{ trainers|length }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-history"></i></div>
          <div class="stat-label">Total Battles</div>
          <div class="stat-value">{{ total_battles }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-trophy"></i></div>
          <div class="stat-label">Win Rate</div>
          <div class="stat-value">{{ win_percentage }}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-heart-broken"></i></div>
          <div class="stat-label">Battles with Deaths</div>
          <div class="stat-value">{{ death_percentage }}%</div>
        </div>
      </div>
    </section>

    <!-- Performance Charts Section -->
    <section class="performance-section">
      <h2><i class="fas fa-chart-bar"></i> Performance Statistics</h2>
      
      <div class="charts-grid">
        <!-- Top Killers Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3><i class="fas fa-skull-crossbones"></i> Most Lethal Pokémon</h3>
            <p class="chart-subtitle">Individual Pokémon with highest kill counts</p>
          </div>
          <div class="chart-content">
            {% if top_killers %}
              {% for pokemon in top_killers %}
              <div class="chart-bar-item">
                <div class="bar-label">
                  <span class="bar-rank">#{{ forloop.counter }}</span>
                  <span class="bar-name">{{ pokemon.name }}</span>
                </div>
                <div class="bar-container">
                  <div class="bar-fill kills-bar" style="width: {{ pokemon.kills|floatformat:0|add:"0" }}00%;" data-max="{{ max_kills }}">
                    <span class="bar-value">{{ pokemon.kills }}</span>
                  </div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="chart-empty">
                <i class="fas fa-inbox"></i>
                <p>No kill data recorded</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Most Used Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3><i class="fas fa-star"></i> Most Used Species</h3>
            <p class="chart-subtitle">Pokémon species brought most often</p>
          </div>
          <div class="chart-content">
            {% if most_used %}
              {% for pokemon in most_used %}
              <div class="chart-bar-item">
                <div class="bar-label">
                  <span class="bar-rank">#{{ forloop.counter }}</span>
                  <span class="bar-name">{{ pokemon.name }} line</span>
                </div>
                <div class="bar-container">
                  <div class="bar-fill usage-bar" style="width: {{ pokemon.count|floatformat:0|add:"0" }}00%;" data-max="{{ max_usage }}">
                    <span class="bar-value">{{ pokemon.count }}</span>
                  </div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="chart-empty">
                <i class="fas fa-inbox"></i>
                <p>No usage data available</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Most Killed Species Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3><i class="fas fa-heart-crack"></i> Most Lost Species</h3>
            <p class="chart-subtitle">Pokémon species that fainted most often</p>
          </div>
          <div class="chart-content">
            {% if most_killed %}
              {% for pokemon in most_killed %}
              <div class="chart-bar-item">
                <div class="bar-label">
                  <span class="bar-rank">#{{ forloop.counter }}</span>
                  <span class="bar-name">{{ pokemon.name }}</span>
                </div>
                <div class="bar-container">
                  <div class="bar-fill deaths-bar" style="width: {{ pokemon.count|floatformat:0|add:"0" }}00%;" data-max="{{ max_deaths }}">
                    <span class="bar-value">{{ pokemon.count }}</span>
                  </div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="chart-empty">
                <i class="fas fa-inbox"></i>
                <p>No death data recorded</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <!-- Trainers List -->
    <section class="trainers-section">
      <h2><i class="fas fa-users"></i> Trainers Battled</h2>

      <div class="trainers-grid">
        {% for trainer in trainers %}
        <div class="trainer-card{% if trainer.has_deaths %} has-deaths{% endif %}" onclick="window.location.href='/xhenos/trainers/{{ trainer.trainer_name|urlencode }}/'">
          <div class="trainer-card-header">
            <div class="trainer-icon">
              <i class="fas fa-user-ninja"></i>
            </div>
            <div class="trainer-info">
              <h3>{{ trainer.trainer_name }}</h3>
              <div class="trainer-battles">
                <i class="fas fa-swords"></i>
                {{ trainer.battle_count }} battle{{ trainer.battle_count|pluralize }}
              </div>
            </div>
          </div>

          <!-- Battle Badges -->
          <div class="trainer-badges">
            {% if trainer.has_deaths %}
            <div class="trainer-badge death-badge">
              <i class="fas fa-skull"></i>
              <span>Deaths</span>
            </div>
            {% endif %}
            
            {% if trainer.highest_difficulty == "1" %}
            <div class="trainer-badge difficulty-badge difficulty-normal">
              <i class="fas fa-circle"></i>
              <span>Normal</span>
            </div>
            {% elif trainer.highest_difficulty == "3" %}
            <div class="trainer-badge difficulty-badge difficulty-extreme">
              <i class="fas fa-skull"></i>
              <span>Extreme</span>
            </div>
            {% else %}
            <div class="trainer-badge difficulty-badge difficulty-hard">
              <i class="fas fa-fire"></i>
              <span>Hard</span>
            </div>
            {% endif %}
          </div>

          <div class="trainer-stats">
            <div class="stat-item">
              <div class="stat-label">Last Battle</div>
              <div class="stat-value">{{ trainer.last_battle|date:"M d" }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Battles</div>
              <div class="stat-value">{{ trainer.battle_count }}</div>
            </div>
          </div>

          <div class="view-trainer-btn">
            <span>View Details</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    {% else %}
    <div class="no-trainers">
      <i class="fas fa-inbox"></i>
      <h3>No Trainers Found</h3>
      <p>No battle records found for {{ player_name }}.</p>
    </div>
    {% endif %}

  </article>
</main>

<script>
// Animate bars on page load
document.addEventListener('DOMContentLoaded', function() {
  const bars = document.querySelectorAll('.bar-fill');
  
  bars.forEach((bar, index) => {
    const maxValue = parseInt(bar.dataset.max);
    const barValue = parseInt(bar.querySelector('.bar-value').textContent);
    const percentage = (barValue / maxValue) * 100;
    
    // Set initial width to 0
    bar.style.width = '0%';
    
    // Animate after a slight delay
    setTimeout(() => {
      bar.style.width = percentage + '%';
    }, 100 + (index * 50));
  });
});
</script>

</body>
</html>