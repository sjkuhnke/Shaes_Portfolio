{% extends 'base.html' %}
{% load static %}
{% load markdown_extras %}

{% block content %}
<article class="project-detail active">
  <a href="{% url 'portfolio' %}" class="back-button">
    <i class="fa-solid fa-arrow-left"></i> Back to Portfolio
  </a>

  <header>
    <h2 class="h2 article-title">{{ project.title }}</h2>
  </header>

  <section class="project-content">
    <div class="image-slideshow">
        <button class="slider-btn prev" onclick="prevSlide()">&#10094;</button>
        <div class="slides-container">
            <div class="slide-wrapper">
                <p class="caption active">{{ project.caption }}</p>
                <img class="slide active" src="{% static 'images/projects/' %}{{ project.folder }}/main.png" alt="{{ project.title }} main image">
            </div>
            {% for image in project.images %}
                <div class="slide-wrapper">
                    <p class="caption">{{ image.caption }}</p>
                    <img class="slide" src="{% static 'images/projects/' %}{{ project.folder }}/{{ image.filename }}" alt="{{ project.title }} screenshot {{ forloop.counter }}">
                </div>
            {% endfor %}
        </div>
    
        <button class="slider-btn next" onclick="nextSlide()">&#10095;</button>
    </div>
    {% if project.live_link %}
      <div class="live-link">
        <a href="{{ project.live_link }}" target="_blank" class="download-btn">
          <i class="fa-solid fa-arrow-up-right-from-square"></i> Live Demo
        </a>
      </div>
    {% endif %}
    <div class="project-description">
      {{ project.description|render_markdown|safe }}
    </div>
  <div class="project-date">
    <i class="fa-solid fa-calendar-days"></i>
    <span>{{ project.date }}</span>
  </div>
    
  <h3 class="section-heading">Technologies Used:</h3>
    <div class="technologies">
      {% for tech in project.technologies %}
        <p><strong>{{ tech.label }}:</strong> {{ tech.value|render_markdown|safe }}</p>
      {% endfor %}
    </div>
  
    {% if project.videos %}
      <div class="local-videos">
        {% for video in project.videos %}
          <video controls>
            <source src="{% static 'videos/projects/' %}{{ project.folder }}/{{ video }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        {% endfor %}
      </div>
    {% endif %}
    {% if project.github_link or project.testimonial_id %}
      <div class="link-row">
        {% if project.github_link %}
        <div class="project-button">
          <a href="{{ project.github_link }}" target="_blank" class="download-btn">
            <i class="fa-brands fa-github"></i> View on GitHub
          </a>
        </div>
        {% endif %}
        {% if project.testimonial_id %}
        <div class="project-button">
          <a href="{% url 'about' %}?testimonial={{ project.testimonial_id }}" class="download-btn">
            <i class="fa-solid fa-envelope"></i> Contact / Testimonial
          </a>
        </div>
        {% endif %}
      </div>
    {% endif %}
  </section>
</article>
    <script>
      let currentSlide = 0;
      const slides = document.querySelectorAll(".slide");
      const captions = document.querySelectorAll(".slide-wrapper .caption");
    
      function showSlide(index) {
        slides.forEach((slide, i) => {
          slide.classList.toggle("active", i === index);
        });
        captions.forEach((caption, i) => {
          caption.classList.toggle("active", i === index);
        });
      }
    
      function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
      }
    
      function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        showSlide(currentSlide);
      }
      
      // setInterval(nextSlide, 5000);
    </script>
{% endblock %}